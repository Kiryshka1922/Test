name: Frontend Basic Checks

on:
  pull_request:
    branches: [ main, develop ]

jobs:
  check-frontend-pr:
    if: startsWith(github.event.pull_request.head.ref, 'frontend/')
    
    runs-on: ubuntu-latest
    name: Frontend PR Validation
    
    steps:
      - name: Print PR info
        run: |
          echo "‚úÖ –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ PR"
          echo "–í–µ—Ç–∫–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: ${{ github.event.pull_request.head.ref }}"
          echo "–í–µ—Ç–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è: ${{ github.event.pull_request.base.ref }}"
      
      - name: Hello World
        run: echo "Hello from frontend PR check!"

      - name: Checkout code
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
      
      - name: Check variables.json sync
        run: |
          echo "üîç Check sync variables.json..."
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
          PR_FILE_EXISTS=$( [ -f "variables.json" ] && echo "true" || echo "false" )
          MAIN_FILE_EXISTS=$( git show origin/main:variables.json >/dev/null 2>&1 && echo "true" || echo "false" )
          
          echo "PR —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: $PR_FILE_EXISTS"
          echo "Main —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: $MAIN_FILE_EXISTS"
          
          # –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
          if [ "$PR_FILE_EXISTS" = "false" ] && [ "$MAIN_FILE_EXISTS" = "false" ]; then
            echo "‚ö†Ô∏è File variables.json does not exist in both branches"
            echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞"
            exit 0
          fi
          
          if [ "$PR_FILE_EXISTS" = "false" ] && [ "$MAIN_FILE_EXISTS" = "true" ]; then
            echo "‚ùå File variables.json does not exist in your branch but exists in main"
            echo "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–¥–µ–ª–∞—Ç—å —Ä–µ–±–µ–π–∑ –≤ main –æ–±–Ω–æ–≤–∏–ª–∏—Å—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ"
            exit 1
          fi
          
          if [ "$PR_FILE_EXISTS" = "true" ] && [ "$MAIN_FILE_EXISTS" = "false" ]; then
            echo "‚ö†Ô∏è File variables.json does not exist in main (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)"
            echo "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è"
            exit 0
          fi
          
          # –ï—Å–ª–∏ –æ–±–∞ —Ñ–∞–π–ª–∞ —Å—É—â–µ—Å—Ç–≤—É—é—Ç - —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º
          echo "–°—Ä–∞–≤–Ω–∏–≤–∞—é variables.json —Å –≤–µ—Ä—Å–∏–µ–π –∏–∑ main..."
          
          # –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å git diff
          if git diff --quiet origin/main:variables.json HEAD:variables.json; then
            echo "‚úÖ variables.json —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω —Å main"
            exit 0
          else
            echo "‚ùå –û–®–ò–ë–ö–ê: variables.json –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –≤–µ—Ä—Å–∏–∏ –≤ main!"
            echo "–ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ä–µ–±–µ–π–∑:"
            echo "  git fetch origin main"
            echo "  git rebase origin/main"
            echo "  # –†–∞–∑—Ä–µ—à–∏—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ"
            echo "  git push --force-with-lease"
            exit 1
          fi